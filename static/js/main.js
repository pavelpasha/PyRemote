!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";function i(e){return new Array(6).join("00").match(/../g).concat(e.toString(16).match(/.{1,2}/g)).reverse().slice(0,6).reverse().join(":").toUpperCase()}function s(e){let t=function(e){let t=new Date(1970,0,1);return t.setSeconds(e),t}(e),n=6e4*t.getTimezoneOffset();t.setTime(t.getTime()-n);return t.toLocaleDateString("en-US",{year:"numeric",month:"numeric",day:"numeric",timezone:"Moskow",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1})}function o(e,t){["success","error","info"].includes(t)||(t="info");let n=document.createElement("div");n.className="notification "+t,n.innerHTML=e,document.body.appendChild(n),setTimeout(()=>document.body.removeChild(n),2e3)}function l(e,t=null,n=null,i=null,s=null){let o=document.createElement(e);if(!o)return null;if(n&&(o.className=n),i&&(o.id=i),s)for(var l in s)s.hasOwnProperty(l)&&o.setAttribute(l,s[l]);return(t instanceof Element||t instanceof HTMLDocument)&&t?t.appendChild(o):o}n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return l}))},function(e,t,n){},function(e,t,n){},,,function(e,t,n){"use strict";n.r(t);var i=n(0);n(1);class s{constructor(e){this._$root=e,this._close_callback=null,this._init()}_init(){this._window=Object(i.a)("div",this._$root,"modal_window");let e=Object(i.a)("div",this._window,"modal_header"),t=Object(i.a)("img",e,"close_btn");t.src="../static/img/close_button.png",t.addEventListener("click",this.close.bind(this)),this._title=Object(i.a)("label",e,"modal_title"),this._body=Object(i.a)("div",this._window),this._busy_div=Object(i.a)("div",this._window,"loader"),this._busy_div.style.display="none",this._dialog=Object(i.a)("div",this._window,"dialog_window"),this._dialog.style.display="none",this._dialog_text=Object(i.a)("div",this._dialog,"dialog_text"),this._dl_no_btn=Object(i.a)("button",this._dialog,"dialog_btn"),this._dl_no_btn.innerHTML="No",this._dl_yes_btn=Object(i.a)("button",this._dialog,"dialog_btn"),this._dl_yes_btn.innerHTML="Yes"}setTile(e){this._title.innerHTML=e}setContent(e){this._body.appendChild(e)}openDialog(e){return this._dialog_text.innerHTML=e,this._dialog.style.display="block",this._body.style.display="none",new Promise((e,t)=>{this._dl_yes_btn.addEventListener("click",function(t){this.closeDialog(),e()}.bind(this),{once:!0}),this._dl_no_btn.addEventListener("click",function(e){this.closeDialog(),t()}.bind(this),{once:!0})})}closeDialog(){this._dialog.style.display="none",this._body.style.display="block"}open(e=null){this._close_callback=e,this._window.style.display="block"}close(){this._window.style.display="none",this.reset(),null!=this._close_callback&&(this._close_callback(),this._close_callback=null)}reset(){this._body.innerHTML="",this._title.innerHTML="",this._body.style.display="block",this._busy_div.style.display="none",this._dialog.style.display="none",this._body.style.display="block"}showBusyIndicator(e=!0){e?(this._body.style.display="none",this._busy_div.style.display="block"):(this._body.style.display="block",this._busy_div.style.display="none")}}n(2);document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementById("app");new r(e)}));let o=function(e){let t=!0;for(let n of e){let e=l(n,a[n.id]);e?n.classList.remove("invalid"):n.classList.add("invalid"),t=t&&e}return t},l=function(e,t){return t(e.value)},a={port_input:e=>""!==e&&/^\d*$/.test(e)&&(""===e||parseInt(e)<=65535),name_input:e=>""!==e,ser_input:e=>""!==e,baudrate_input:e=>""!==e&&/^\d*$/.test(e)&&(""===e||parseInt(e)<=256e3),format_input:e=>/^(?=.*\{\bhost\b\})(?=.*\{\bport\b\}).*$/.test(e),host_input:e=>{if(0===e.length||e.length>511)return!1;return/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.test(e)||/^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)+([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$/.test(e)}};class c{constructor(e,t,n,i){this.hwId=e,this.status=t,this.name=n,this.table_row=i,this.is_opening_now=!1}equals(e){return e.status==this.status&&e.name==this.name}}const d=Object.freeze({NAME:0,STATUS:1,HWID:2});class r{constructor(e){this._$root=e,this._devices={},this._selected_device_id=null,this.POLL_FREQUENCY_SEC=1e4,this._createDevicesListTable(),this._modal=new s(e),this._updateDeviceList(),setInterval(this._updateDeviceList.bind(this),this.POLL_FREQUENCY_SEC)}_createDevicesListTable(){this._dev_table=Object(i.a)("table",this._$root,"table clients"),this._dev_table.innerHTML="<thead><tr><th>Device Name</th><th>Status</th><th>MAC</th></tr></thead>"}_appendDeviceToTable(e,t){let n=this._dev_table.insertRow(t);n.insertCell(d.NAME).appendChild(document.createTextNode(e.name)),n.insertCell(d.STATUS).appendChild(document.createTextNode(e.status>0?"Connect":"Last online: "+Object(i.b)(e.last_update))),n.insertCell(d.HWID).appendChild(document.createTextNode(Object(i.c)(e.hwId))),n.cells[d.STATUS].classList.add("clickable"),n.cells[d.STATUS].addEventListener("click",function(){this._showConnectionOptions(e.hwId)}.bind(this));let s=Object(i.a)("div",n.cells[d.NAME],"options-wrapper");n.cells[d.NAME].addEventListener("mouseover",(function(){s.style.visibility="visible"})),n.cells[d.NAME].addEventListener("mouseout",(function(){s.style.visibility="hidden"}));let o=Object(i.a)("img",s,"option");o.src="../static/img/remove.png",o.addEventListener("click",function(){this._modal.open(),this._modal.openDialog("Are you sure?").then(()=>{this.removeDevice(e.hwId)},()=>this._modal.close())}.bind(this));let l=Object(i.a)("img",s,"option");l.src="../static/img/stat.png",l.addEventListener("click",(function(){window.location.href="/log?hwId="+e.hwId}))}_updateDeviceList(){fetch("/api/get_online_clients").then(e=>e.json()).then(e=>{let t=1;e.forEach(e=>{if((e=JSON.parse(e)).hwId in this._devices){if(this._devices[e.hwId].status!=e.status){let t=this._devices[e.hwId].table_row,n=e.status>0?"Connect":"Last online: "+Object(i.b)(e.last_update);this._dev_table.rows[t].cells[d.STATUS].innerHTML=n,this._devices[e.hwId].status=e.status}}else this._devices[e.hwId]=new c(e.hwId,e.status,e.name,t),this._appendDeviceToTable(e,t),t++})})}resetDeviceList(){this._devices={},this._dev_table.innerHTML="<thead><tr><th>Device Name</th><th>Status</th><th>MAC</th></tr></thead>",this._updateDeviceList()}removeDevice(e){this._modal.showBusyIndicator(),fetch("/api/delete_slaver?id="+e).then(e=>e.json()).then(e=>{"success"==e.status?(Object(i.d)("Device deleted","success"),this.resetDeviceList()):Object(i.d)("Something went wrong","error")}).catch(()=>Object(i.d)("Something went wrong","error")).finally(()=>this._modal.close())}async _showConnectionOptions(e){if(this._devices[e].status<1)return;this._selected_device_id=e;let t=await this._getTemplates(e);0==t.templates.length?this._openCustomConnectionDialog():this._showConnetionTemplatesList(t.templates)}_showConnetionTemplatesList(e){this._modal.reset();let t=Object(i.a)("div",null,"templates_wrapper"),n=Object(i.a)("table",t,"table templates"),s=Object(i.a)("tbody",n);for(let t of e){let e=Object(i.a)("tr",s),n=Object(i.a)("td",e,"clickable"),o=Object(i.a)("td",e,"clickable");n.addEventListener("click",function(){this._editTemplate(t)}.bind(this)),o.addEventListener("click",function(){this._openTunnel(t)}.bind(this)),n.appendChild(document.createTextNode(t.name)),o.appendChild(document.createTextNode("Connect"))}let o=Object(i.a)("button",t,"button default bottom");o.innerText="Custom",o.addEventListener("click",function(){this._openCustomConnectionDialog()}.bind(this)),this._modal.setContent(t),this._modal.setTile("New connection"),this._modal.open()}_openCustomConnectionDialog(){this._modal.reset();let e={autocomplete:"off"},t=Object(i.a)("div",null,"connection_options");Object(i.a)("label",t).innerHTML="Proto: ";let n=Object(i.a)("select",t);n.innerHTML='<option value="tcp" selected="selected">TCP</option>\n        <option value="serial">Serial</option> ',n.addEventListener("change",()=>{0==n.selectedIndex?(s.style.display="block",l.style.display="none"):(s.style.display="none",l.style.display="block")});let s=Object(i.a)("div",t,"connection_options"),l=Object(i.a)("div",t,"connection_options");l.style.display="none",Object(i.a)("label",s).innerHTML="Host: ";let a=Object(i.a)("input",s,"inputBox","host_input",e);a.value="192.168.1.1";let c=Object(i.a)("label",s);c.innerHTML="Port: ",c.style.margin="5";let d=Object(i.a)("input",s,"inputBox","port_input",e);d.value="22",Object(i.a)("label",l).innerHTML="Serial name: ";let r=Object(i.a)("input",l,"inputBox","ser_input",e);r.value="COM1";let u=Object(i.a)("label",l);u.innerHTML="Baudrate: ",u.style.margin="5";let h=Object(i.a)("input",l,"inputBox","baudrate_input",e);h.value="9600";let _=Object(i.a)("button",t,"button left_side_wide bottom");_.innerText="Open tunnel",_.addEventListener("click",function(){if(!o([d,a]))return void Object(i.d)("Wrong parameter(s) given");let e={ssl:!1,proto:n.value},t={format:"{host}:{port}",options:e};0==n.selectedIndex?(e.host=a.value,e.port=d.value):(e.ser_name=r.value,e.rate=h.value),this._openTunnel(t)}.bind(this));let p=Object(i.a)("button",t,"button rigth_side_small");p.innerText="Save",p.addEventListener("click",function(){let e={proto:n.value};0==n.selectedIndex?(e.host=a.value,e.port=d.value):(e.ser_name=r.value,e.rate=h.value);let t={id:-1,name:"Custom template",format:"{host}:{port}",options:e};this._editTemplate(t)}.bind(this)),this._modal.setContent(t),this._modal.setTile("Custom connection"),this._modal.open()}_openTunnel(e){this._devices[this._selected_device_id].is_opening_now||(this._devices[this._selected_device_id].is_opening_now=!0,this._modal.showBusyIndicator(),e.options.id=this._selected_device_id,fetch("/api/open_tunnel",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e.options)}).then(e=>{if(e.ok)return e.json();Object(i.d)("Something went wrong","error"),Promise.reject(e)}).then(t=>{"ok"==t.status?(console.log(t),this._showConnectionDetails(window.location.hostname,t.port,t.id,e.format),this._devices[this._selected_device_id].status=t.port):Object(i.d)("Something went wrong","error")}).catch(()=>Object(i.d)("Something went wrong","error")).finally(()=>{this._devices[this._selected_device_id].is_opening_now=!1,this._modal.showBusyIndicator(!1)}))}_closeTunnel(e){this._modal.showBusyIndicator(),fetch("/api/close_tunnel?tunnel_id="+e).then(e=>e.json()).then(e=>{"success"==e.status?(Object(i.d)("Tunnel closed","success"),this._showConnectionOptions(this._selected_device_id)):Object(i.d)("Something went wrong","error")}).catch(()=>Object(i.d)("Something went wrong","error")).finally(()=>this._modal.showBusyIndicator(!1))}_showConnectionDetails(e,t,n,s=null){this._modal.reset();let o=Object(i.a)("div",null,"connection_details");Object(i.a)("label",o,"generic_label").innerHTML="Tunnel now running on:",Object(i.a)("br",o);let l=Object(i.a)("label",o,null,"tunnel_address");l.innerHTML=null==s?`${e}:${t}`:s.replace("{host}",e).replace("{port}",t),Object(i.a)("br",o);let a=Object(i.a)("button",o,"button left_side_wide bottom");a.innerText="Copy to clipboard",a.addEventListener("click",function(){this._copyToClipboard(l),Object(i.d)("Copied to clipboard","success")}.bind(this));let c=Object(i.a)("button",o,"button rigth_side_small");c.className="button rigth_side_small",c.innerText="Close",c.addEventListener("click",function(){this._modal.openDialog("Are you sure?").then(()=>this._closeTunnel(n))}.bind(this)),this._modal.setContent(o),this._modal.setTile("Connection details"),this._modal.open()}_editTemplate(e){let t=-1!=e.id;this._modal.reset();let n={autocomplete:"off"},s=Object(i.a)("div",null,"template_options");Object(i.a)("label",s).innerHTML="Proto: ";let l=Object(i.a)("select",s);l.innerHTML='<option value="tcp">TCP</option>\n        <option value="serial">Serial</option> ',l.style.marginBottom="3",l.value=e.options.proto,l.addEventListener("change",()=>{0==l.selectedIndex?(c.style.display="block",d.style.display="none"):(c.style.display="none",d.style.display="block")}),Object(i.a)("br",s),Object(i.a)("label",s).innerHTML="Name: ";let a=Object(i.a)("input",s,"inputBox","name_input",n);a.value=e.name;let c=Object(i.a)("div",s),d=Object(i.a)("div",s);Object(i.a)("label",c).innerHTML="Host: ";let r=Object(i.a)("input",c,"inputBox","host_input",n);r.value=e.options.host||"127.0.0.1";let u=Object(i.a)("label",c);u.innerHTML="Port: ",u.style.margin="5";let h=Object(i.a)("input",c,"inputBox","port_input",n);h.value=e.options.port||"22",Object(i.a)("label",s).innerHTML="Format: ";let _=Object(i.a)("input",s,"inputBox","format_input",n);_.value=e.format,Object(i.a)("label",d).innerHTML="Serial: ";let p=Object(i.a)("input",d,"inputBox","ser_input",n);p.value=e.options.ser_name||"COM1",Object(i.a)("label",d).innerHTML="Rate: ";let b=Object(i.a)("input",d,"inputBox","baudrate_input",n);b.value=e.options.rate||"9600";let m=Object(i.a)("button",s,"button default bottom",n);if(m.innerText="Save",m.addEventListener("click",function(){let t=!1,n={ssl:!1,proto:l.value};if(0==l.selectedIndex?(n.host=r.value,n.port=h.value,t=o([_,r,a,h])):(n.ser_name=p.value,n.rate=b.value,t=o([_,p,a,b])),!t)return void Object(i.d)("Wrong parameter(s) given");let s={id:e.id,name:a.value,format:_.value,options:n};this._saveTemplate(s)}.bind(this)),t){m.className="button left_side_wide bottom";let t=Object(i.a)("button",s,"button rigth_side_small");t.className="button rigth_side_small",t.innerText="Delete",t.addEventListener("click",function(){this._modal.openDialog("Are you sure?").then(()=>this._deleteTemplate(e.id))}.bind(this))}l.dispatchEvent(new Event("change")),this._modal.setContent(s),this._modal.setTile(t?"Edit template":"Create template"),this._modal.open()}_deleteTemplate(e){this._modal.showBusyIndicator(),fetch("/api/delete_template?template_id="+e).then(e=>e.json()).then(e=>{"success"==e.status?(Object(i.d)("Template deleted","success"),this._showConnectionOptions(this._selected_device_id)):Object(i.d)("Something went wrong","error")}).catch(()=>Object(i.d)("Something went wrong","error")).finally(()=>this._modal.showBusyIndicator(!1))}_saveTemplate(e){this._modal.showBusyIndicator(),e.hwid=this._selected_device_id,fetch("/api/save_template",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{"success"==e.status?(Object(i.d)("Template saved","success"),this._showConnectionOptions(this._selected_device_id)):Object(i.d)("Something went wrong","error")}).catch(()=>Object(i.d)("Something went wrong","error")).finally(()=>this._modal.showBusyIndicator(!1))}async _getTemplates(){let e=null;return await fetch("/api/get_templates?id="+this._selected_device_id).then(e=>e.json()).then(t=>e=t),e}async _getDeviceStatus(){let e=-1;return await fetch("/api/get_client_status?id="+this._selected_device_id).then(e=>e.text()).then(t=>e=parseInt(t)),e}_copyToClipboard(e){navigator.clipboard.writeText(e.innerHTML)}}}]);